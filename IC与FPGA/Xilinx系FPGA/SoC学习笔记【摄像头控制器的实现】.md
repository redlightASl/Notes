# 数字摄像头控制器

在SoC中常常集成通用的数字摄像头控制器，比如STM32中集成的DCMI或ESP32中集成的DVP摄像头控制器，以进行数字摄像头的CMOS传感器数据读取。在常见的FPGA设计（毕业设计）中也常常搭建专用的数字摄像头控制器IP来实现对某一特定品牌特定接口摄像头的方便控制

一个基于CMOS传感器的数字摄像头常常通过两套协议与主机通讯：用于传输大量数据流的数据流接口通讯协议，最常见的协议有DVP和MIPI；和用于控制CMOS传感器内部寄存器的控制接口通讯协议，最常见的就是SCCB（简化版I2C）

有些摄像头集成了一个USB控制器，可以作为USB OTG-Slave设备接入主机，以USB协议进行通讯，这里暂且不表。

本篇主要介绍如何搭建一套传统的数字摄像头控制器（就像STM32的DCMI那样），以OV7725和OV5640为例

### OV7725与OV5640

二者都是OmniVision出品的摄像头模块，OV5640比OV7725的产品定位更高。

OV7725是200万像素的摄像头模块，只支持DVP协议和SCCB控制接口，支持自动白平衡等一些基本的数字图像处理功能；OV5640同时支持DVP协议和MIPI协议，同样使用SCCB接口进行控制，相比OV7725像素更高（500万），同时支持QSXVGA（2592*1944）及以下任意分辨率视频输出，支持自动对焦。

OV5640寄存器比较多，所以使用16位地址；而OV7725使用8位地址

> OV5640器件地址7'h3c

## 通用的数字摄像头控制器（数据流接口）

大多数数字摄像头数据流接口采用DVP或者MIPI，MIPI采用LVDS差分电平，需要硬件提供特殊支持才能使用，而低端摄像头模块一般都会使用DVP接口，这个接口具有下面几个信号线：

* dvp_data[7:0]：8线数据并口
* dvp_sccb_scl：SCCB总线的时钟接口
* dvp_sccb_sda：SCCB总线的数据接口
* dvp_pclk：CMOS芯片输出的像素时钟
* dvp_xclk：提供给CMOS芯片的时钟接口
* dvp_vsync：场同步信号
* dvp_href：行同步信号
* dvp_reset_n：CMOS复位信号
* dvp_pwdn：模式控制接口

其中两个SCCB接口可以通过I2C进行写控制（然而**不能直接用I2C控制器进行SCCB总线读控制**，因为二者写时序兼容但读时序不兼容）







## 专用摄像头控制器（数据流接口+控制逻辑）



















