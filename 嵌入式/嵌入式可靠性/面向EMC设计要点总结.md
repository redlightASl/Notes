# 面向EMC设计要点总结

## 基本原则

1. 尽可能保持外围电路简单，能用集成电路就不用分立元件
2. 具有一定电磁兼容性，能够低于周围电磁场干扰，并能较少影响周围环境
3. 系统具有可测试性，可以通过引出测试点、调试接口等方式实现
4. 电路设计与选型统筹兼顾，着重于某一方面，但不能让其他电路性能受损

## 模拟数字混合电路

**电路特性**：数字电路的频率高，模拟电路的敏感度高

高频的信号线应尽可能远离敏感的模拟电路器件。由于数字信号一般为矩形波，带有大量的谐波。如果电路板中的数字地与模拟地没有从接入点分开，数字信号中的谐波很容易会干扰到模拟信号的波形。当模拟信号为高频或强电信号时，也会影响到数字电路的正常工作。存在问题的根本原因是，无法保证电路板上铜箔的电阻为零，在接入点将数字地和模拟地分开，就是为了将数字地和模拟地的共地电阻降到最小

> 在板内，数字地和模拟地实际上是分开的，只是在PCB与外界连接的接口处有一点短接

对于低频模拟电路，除了加粗和缩短地线之外，电路各部分采用**一点接地**是抑制地线干扰的最佳选择，主要可以防止由于地线公共阻抗而导致的部件之间的互相干扰。而对于高频电路和数字电路，由于这时地线的电感效应影响更大，一点接地会导致实际地线加长而带来不利影响，这时应采取**分开接地和一点接地相结合**的方式。另外对于高频电路还要考虑如何**抑制高频辐射噪声**。

模拟地/模拟电源与数字电源通过电感/磁珠单点连接

**设计技巧**：两个地起不同的名字，分别辅铜，最后可以**用一个10uH电感（最大不超过100uH）或0欧姆电阻连起来**，模拟部分的器件尽量集中，放置在与其它板子接口的附近，减小信号衰减。先对模拟地敷铜，然后对整个板敷数字地。模拟地和数字地间的串接可以采用四种方式：用磁珠连接；用电容连接；用电感连接；用零欧姆电阻连接，一般情况下用零欧电阻或磁珠是最佳选择

**磁珠**采用在高频段具有良好阻抗特性的铁氧体材料烧结制成，专用于抑制信号、电源线上的高频噪声和尖峰干扰，还具有吸收静电脉冲的能力。磁珠有很高的电阻率和磁导率，等效于电阻和电感串联，但**电阻值和电感值都随频率变化**。它比普通电感有更好的高频滤波特性，在高频时呈现阻性，所以能在相当宽的频率范围内保持较高的阻抗，从而提高调频滤波效果。**磁珠对高频信号才有较大阻碍作用**，它在低频时电阻比电感小得多

铁氧体磁珠不仅可用于电源电路中滤除高频噪声，还可广泛应用于其它电路，其体积可以做得很小。特别是在数字电路中，由于脉冲信号含有频率很高的高次谐波，也是电路高频辐射的主要根源，所以可在这种场合发挥磁珠的作用。在电路中只要导线穿过它即可。当铁氧体对低频电流几乎没有什么阻抗，而对较高频率的电流会产生较大衰减作用

**干扰三要素**：1. 干扰源（$\frac{di}{dt}$， $\frac{du}{dt}$大的地方就是干扰源）；2. 干扰传播路径（通过导线的传导和空间的辐射等）；3. 敏感器件（ADC、数字IC、AMP等容易被干扰的器件）

### 抗干扰设计原则

* 抑制干扰源：减小$\frac{di}{dt}$， $\frac{du}{dt}$

    基本方法：

    1. 在干扰源回路串联电感或电阻
    2. 给电机加滤波电路，减小电容、电感引脚长度
    3. 在大电感旁边增加续流二极管
    4. 在继电器接点两端并接火花抑制电路（RC串联电路，电阻一般选几K到几十K，电容选0.01uF）
    5. 电路板上每个IC的VCC和GND引脚间要并接一个0.01μF~0.1μF高频电容，以减小IC对电源的影响；电容布线应尽量粗短、靠近电源端
    6. 布线时避免90度折线，减少高频噪声发射
    7. 可控硅两端并接RC抑制电路，减小可控硅产生的噪声

* 切断干扰传播路径：切断传导干扰、减小辐射干扰

    基本方法：

    1. 要给单片机电源加滤波电路或稳压器，以减小电源噪声对单片机的干扰（可以利用磁珠、电阻和电容组成π形滤波电路，尽量不要用LC滤波）
    2. 如果单片机的I/O口用来控制电机等噪声器件，在I/O口与噪声源之间最好加隔离（增加π形滤波电路）
    3. 晶振与单片机引脚尽量靠近，用地线把时钟区隔离起来，晶振外壳接地并固定
    4. 电路板合理分区，尽可能把干扰源与敏感元件远离，最好用地线把数字区与模拟区隔离，数字地与模拟地要分离，最后在一点接于电源地，单片机和大功率器件的地线要单独接地，以减小相互干扰
    5. 在单片机I/O口，电源线，电路板连接线等关键地方使用抗干扰元件如磁珠、磁环、电源滤波器，屏蔽罩，可显著提高电路的抗干扰性能

* 提高敏感器件的抗干扰性能

    提高敏感器件的抗干扰性能是指从敏感器件这边考虑尽量减少对干扰噪声的拾取，以及从不正常状态尽快恢复的方法

    基本方法：

    1. 布线时尽量减少回路环的面积，以降低高频辐射感应噪声，防止仪器处于强磁场中时产生感应电流
    2. 如果只是低频电路，则应避免地线环路；高频时，可通过磁珠把模拟和数字地一点共地
    3. 不要有无用的大面积铜箔
    4. 电源线和地线要尽量粗，降低噪声对地阻抗压降，抑制耦合噪声
    5. 单片机闲置的I/O口不要悬空，要接地或拉高；IC的闲置端在不改变系统逻辑的情况下接地或接电源
    6. 对单片机使用电源监控及看门狗电路
    7. 在速度能满足要求的前提下，尽量降低单片机的晶振和选用低速数字电路
    8. IC器件尽量直接焊在电路板上，少用IC座

### 布线技巧

以下内容转自知乎https://www.zhihu.com/question/33455263/answer/1697154500

4层板从上到下依次为：信号平面层、地、电源、信号平面层

6层板从上到下依次为：信号平面层、地、信号内电层、信号内电层、电源、信号平面层

6层以上板(优点是：防干扰辐射)，优先选择内电层走线，走不开选择平面层，**禁止从地或电源层走线**(原因：会分割电源层，产生寄生效应)

多电源系统的布线：如FPGA+DSP系统做6层板，一般至少会有3.3V+1.2V+1.8V+5V，**3.3V**一般是主电源，**直接铺电源层**，通过过孔很容易布通全局电源网络；5V一般可能是电源输入，只需要在一小块区域内铺铜。且尽量粗，越粗越好；1.2V和1.8V是内核电源，布局时尽量将1.2V与1.8V分开，并让1.2V或1.8V内相连的元件布局在紧凑的区域，使用铜皮的方式连接

电源与地线靠近走线，注意减小回路面积，这样能降低电磁干扰

因为电源网络遍布整个PCB，如果采用走线的方式会很复杂而且会绕很远，使用**铺铜皮**的方法是一种很好的选择

**邻层之间走线采用交叉方式**

晶振离芯片尽量近，且晶振下尽量不走线，铺地网络铜皮

连接器上信号的排布对布线的难易程度影响较大，因此要**边布线边调整原理图上的信号**(但**千万不能重新对元器件编号**)

## 板级信号传输设计

下面的“nW”代表n倍线宽

### 避免直角走线

1. 带来寄生电容
2. 线宽变宽，会带来阻抗连续，产生反射
3. 产生天线效应，可能导致EMI
4. PCB生产中可能产生“酸角问题”

最好使用圆弧（半径大于3W）走线或者45度角走线（外侧大于2W，内侧1W）

### 走线基本技巧

顶层和底层之间应当正交走线

当PCB布线受到结构限制，难以避免出现平行布线，特别是在信号速率较高时，应考虑用**地平面**隔离各布线层，用地线隔离各信号线

走线间距遵循3W原则（导线之间的相互干扰可以降低70%）或10W原则（高速走线，相互干扰可减少98%）

3W原则：导线与导线之间的间距应该大于3倍的导线宽度

在电源和地等网络走线时尽量采用树形走线

高速线走线时，走线长度不能等于波长的整数倍，整数倍的情况会产生谐振，导致电磁辐射产生

### 地线回路原则

1. 地线构成的环面积应该尽可能小，较少对外辐射
2. 数字地和模拟地进行隔离，在接口处用隔离电感连接

### 关于滤波电容

滤波电容最好放在电源和地之间

并联滤波电容会导致负载容性增大

### 低速布线

在低速电路中，直角走线、平行布线是可以接受的——但是相对应**千万不要把这个习惯代入高速电路中**

垂直布线是相邻信号层的走线之间要相互垂直来减少相互之间互感引起的串扰，但是在小规模（20条以下并排走线）、低速（100MHz以下）时，相邻信号层的垂直布线与否影响不大；在高速乃至射频（数GHz）的电路中，走线之间才会发生空穴谐振，导致严重的串扰，这就是高速电路采用多层板的目的

直角布线往往也仅对高速电路起效——但是除非电路板工作在几十GHz的高速状态下，引线走直角是完全可以接受的，上世纪电路板工艺不足时也往往在500MHz以下的电路中使用直角走线，事实证明这对信号完整性影响微不足道

不过个人认为低频板最好不要使用直角布线，一是为了增加走线物理强度——带有圆边和钝角的走线在使用过程中很难因为磕碰发生卷边翘起等极端损坏，但直角走线就可能发生这种情况（事实上作者就遇到过）；二是为了美观——直角太尖锐会破坏电路整体外观，也与芯片排列不协调；三就是让电路有容错余地，如果在硬件Debug过程中涉及到高频影响，不会导致莫名其妙的问题

整个布线应该以电路板的速度为最优先——如果电路速度要求不大但布线数量多工期紧张，完全可以适当放弃布线优化原则以换取更快的布线速度和更少的迭代优化次数

## 射频电路

### 使用网络分析仪测试天线性能

网络分析仪接入天线后，会显示一个V型曲线，表示天线在各频率的驻波比

将网分仪跳到回波损耗功能，可以测试天线的具体回波损耗，某频率对应回波损耗越小，表示该频率下天线性能越好

在进行天线阻抗匹配时，通常可以用网分仪进行辅助

天线阻抗匹配过程就是使用Π型或P型LC匹配网络优化天线驻波比和回波损耗的过程，阻抗匹配不一定需要，但是加入阻抗匹配后，往往能让天线性能得到优化

### 晶振下方的铺铜

晶体下面铺铜，会导致晶振产生的高频信号串扰到铜皮，进而减少向空间中辐射的干扰；但是在有精密模拟电路的情况下，晶振的高频干扰会通过铜皮对模拟地造成污染，相当于把原本一个很好的屏蔽地平面变得有波动了。

正规产品上市前都会做各种各样的认证，尤其是高频的NFC、WiFi信号，会要求外溢电磁辐射不能对人体或其他物品造成干扰，这就需要铺铜——但又反过来造成模拟电路部分的不稳定。所以一些公司采用的策略是晶振等高频器件下不铺铜，而是在产品外增加外壳和屏蔽罩，使用二次屏蔽的方法消除掉了这些干扰

如果产品中需要准确衡量晶振铺铜造成有利影响和有害影响，还需要对地平面耦合的干扰进行仿真。

总的来说电路板上没有高频信号或高精度模拟信号的情况下，铺铜利大于弊，对数字电路的EMI还会有较强改善作用；但只要电路板上存在高频或高精度模拟信号，就不应当贸然在晶振下铺铜

## 符合EMC的设计规则自查

1. 一般电源防雷保护器件的顺序是：

    压敏电阻、保险丝、瞬态抑制二极管TVS、EMI滤波器、电感或共模电感

2. 一般接口保护器件的顺序是：

    ESD（TVS）、隔离变压器、共模电感、电容、电阻

3. 严格按照合理的原理图顺序进行布线

4. 电平变换芯片要靠近连接器放置

5. 敏感器件（NMOS、CMOS器件等）尽量远离可能存在干扰的区域（如板边）

6. 晶体、晶振、PLL等时钟信号元件要与相关的IC尽量靠近，让时钟信号尽量短；高速晶振输出要串接22Ω的阻抗匹配电阻

7. 时钟电路电源滤波器靠近时钟电路电源端，布局要注意远离大功率原件，且晶振距离板边和接口器件距离大于1inch

8. 时钟电源要加宽或使用铺铜

9. 超过1inch的时钟线要走带状线，否则使用微带线。带状线时钟在表层（微带线）部分的走线距离要小于50mil

10. 时钟线不允许跨分割

11. 时钟线要采用立体包地处理且与其他信号线间距满足5W原则

12. PLL不能包含悬空引脚，不使用的引脚要通过电阻接地

13. 不同接口间走线要清晰，不能相互交叉；接口线必须经过保护、滤波器件再到信号接收IC，且中间走线距离要尽量短

14. 接插件固定孔接到机壳地或保护地

15. 变压器、光耦、数字隔离器前后的地要分开

16. 高速信号线换层时要增加回流地过孔

17. 电源平面要满足20H原则，一般来说内缩30mil~40mil即可，并且要注意间隔150mil打地孔

18. 布线时要避免STUB线

    