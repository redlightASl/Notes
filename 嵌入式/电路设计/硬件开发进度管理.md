# 硬件开发进度管理

硬件项目，尤其是软硬件结合的智能硬件项目，与软件开发存在着非常大的差异。本篇博文就来结合自身理解谈一谈硬件项目开发进度管理相关的理论知识。

## 智能硬件的项目阶段

智能硬件是一个非常宽泛的概念，这里将我们要谈的范围局限在单板/多板组合硬件搭配实时控制软件和边缘端/云端计算软件的嵌入式产品。像是打卡机、扫地机器人、工业机械臂、智能音箱等都属于本篇探讨的范围。虽然这些设备都属于复杂系统，但是我们总能将其拆解为**硬件**（Hardware，HW）、**软件**（Software，SW）、**外观**（Identity，ID）、**结构**（Mechanic Design，MD）、**云平台**。其中硬件包含单板硬件、片上硬件（FPGA/CPLD）、多板互联；软件包含板级支持包（BSP）、底层引导程序（Bootloader）、操作系统与中间件（OS/Middleware）、应用程序（Application）、智能算法（AI）；云平台部分则包含云服务、后台、App、小程序等等，这里就先不展开了

虽然拆分以后，每个子系统都可以交付给专人负责，但还是非常复杂，这就需要在开发中引入合理的方法论，统筹管理进度，处理突发事件和需求变更。一般来说**智能硬件产品更加适用瀑布流开发**而不是互联网的敏捷开发，云平台部分通常交由专门的人员来完成，并作为一个大的子项目合并到总体开发流程中。

### IPD

**集成产品开发**（Integrated Product Development，**IPD**）理论原语《产品及生命周期优化法》一书，目前很多硬件科技公司都在采用该方法论来实现下面几个基本目的：

1. 缩短产品研发周期
2. 降低产品成本
3. 提高人均产出率
4. 降低研发费用占比
5. 提高产品质量

根据上面对设备部件的分类，可以将IPD进度管理以下面的表格划分

| 阶段         | 项目环节     | 实现步骤                         |
| ------------ | ------------ | -------------------------------- |
| 调研         | 项目导入     | 市场调查                         |
|              |              | 技术评估                         |
| 立项         | 立项会议     | 立项会议                         |
| PCBA单板设计 | 单板开发     | 方案设计                         |
|              |              | 项目配置确认、主板立项           |
|              |              | 原理图设计                       |
|              |              | 结构堆叠设计                     |
|              |              | 外围器件确认                     |
|              |              | 堆叠评审                         |
|              |              | 原理图优化                       |
|              |              | Layout                           |
|              |              | 第二轮Layout或打样               |
|              | PCBA试产     | PCBA试产物料准备                 |
|              |              | PCBA功能测试环境搭建             |
|              |              | PCBA试产软件开发                 |
|              |              | PCBA试产工程文件整理             |
|              |              | PCBA试产治具制作                 |
|              | PCBA验证测试 | SMT                              |
|              |              | 单板测试                         |
|              |              | 第二版测试                       |
| 外观结构开发 | ID           | ID设计                           |
|              |              | ID评估                           |
|              |              | 整机项目配置                     |
|              | MD           | MD设计                           |
|              |              | MD评审                           |
|              |              | MD投模                           |
|              |              | 结构辅料、连接器、副板、夹具制作 |
|              | 包装         | 包装、说明书设计                 |

### 外观和结构设计

一款新产品的基础就是ID设计，消费级产品总是要卖给一般消费者的，外观是消费者购买的一个重点因素；虽然企业级产品一般“注重内在”，但2B/2G的产品也要考虑外观不能做得太丑。

ID设计出2D渲染图后，就可以将其作为一个立项依据画大饼了，这时候硬件/软件/结构/云平台的开发/研发就要介入，做方案设计、软硬件评审等，完全通过后就可以进行详细设计。这一步是PCBA和软件设计的前提

HW需要对接ID、SW、MD，交接硬件的器件布局图、引脚图、关键器件尺寸等。SW需要对接HW、云平台，分别给出BSP的要求和API接口等。ID则根据MD的堆叠设计图进行3D建模，细化外观、内构；结构同步根据建模图制作详细结构设计，二者相互推进，并将进展共享给HW，如果涉及到冲突，可能还需要与SW协调。

详细结构设计完成转给模具厂、加工厂，ID和MD就可以转向其他工作了。HW往往需要更长的时间来完成PCBA设计。

### PCBA单板设计

对于硬件开发，要把主要精力放在硬件设计方案，核心物料选型，原理图，Layout四个关键步骤上，还要对后续的EMC、安规等检测步骤做预扫

板级硬件的嵌入式软件很少会严格按照软件工程的思维进行规划设计，主要是因为嵌入式软件是和单板业务强耦合的，一般只由一个人负责，最多会涉及不超过6人的小团队，好的嵌入式软件工程师必须有清晰的系统架构，并且会向上管理产品软件需求。只要能够保障*嵌入式软件可靠性*，软件部分就是合格的。

在HW接手ID的总体设计后需要结合需求功能设计单板，并与MD同步规划堆叠设计。由于硬件设计需要长周期物料备料和较长时间的打样周期，需要综合供应链和生产链设计单板。

### 从生产资料打包到单板测试

完成全部硬件设计后，SW就要开始介入了。

项目进度管理中，软件联调（尤其是首次软件联调）的时间点需要得到合理安排。必须注意如果固件要升级，还应该让单板硬件部分预留烧录点——一般来说软件不可能上板一次跑通，因此需要预留变更的升级方式（板烧、片烧、OTA都是可行的选项）

硬件生产资料（包括gerber文件、PCB工艺要求、BOM表、点位图、坐标文件、SMT要求）打包前，SW就应当开始BSP的开发，而上层的算法和云端软件应当在更早时刻开发。从生产资料打包发送到初版联调之间大约有不到一周时间，大多数情况下足以完成软件部分，正好可以在初版PCBA完工后烧录程序开始单板调试。

对于IPD来说，应当将硬件迭代作为例程（Routine）而不是异常（Exception），通过合理的时间点规划为硬件出错调试腾出时间，从而让项目在规定工期前完成。

### 嵌入式软件开发

嵌入式软件的开发主要分成：

* 片上硬件验证（包括FPGA和CPLD）
* 片上硬件开发
* 片上硬件算法
* 软件系统BSP（包括裸机BSP和RTOS-BSP）
* 软件驱动（包括RTOS驱动和嵌入式Linux驱动）
* Bootloader
* Linux内核移植和根文件系统调试

这里将FPGA和CPLD的硬件开发也归类为软件，但实际上片上硬件开发由于受到编程语言和开发难度限制，与传统软件开发区别很大，进度管理上也应当使用不同的方式。

片上硬件开发最大的特点就是难以调试，因此很多时候需要在服务器上仿真；与软件编译不同，大工程的硬件综合通常需要数十分钟到数小时乃至几天，这就需要大量的测试工作，因此对于小团队比较合适的方法是两个人负责片上硬件，一人负责业务代码，一人负责测试用例和脚本开发。即使如此，一个成熟的IP设计也需要数周乃至数月时间才可以完成。

不过对于大多数应用，片上硬件的主要业务就是连接各个高速接口和控制高速的AD/DA，更复杂的业务就是采用APSOC单片完成FPGA+嵌入式Linux的功能（进行ISP、DSP等），因此可以调用厂商提供的接口IP。由于FPGA往往引脚资源很丰富，所以很多时候不必参考硬件原理图可提前开始进行功能性验证，同步与HW出IO Bank、Serdes Pin的安排，再到物理约束修改即可

软件部分就是传统的嵌入式开发流程，根据硬件给出的原理图和引脚安排来编写BSP、Linux驱动等。将嵌入式Linux移植上板以后，基本任务就完成了。后续流程要和云平台协作出端App和云App，算法部分通过CPU、GPU、NPU、硬件加速等手段部署到片上

所有嵌入式软件应当打包成固件（firmware），统一烧录到板。

等待SMT和硬件基础调试完成后，软件即可开始联调，项目管理中应当为软硬件联调预留一周以上时间，确保出现问题的情况下能够及时补救，不至于耽误期限

### 云端软件开发

云端软件本质上就是互联网行业常见的业务了，不管是外包还是由专门的产品经理PM负责，都可以套用软件工程来解决，可以视为与智能硬件解耦，因此算是不需要多加操心的

> 找一个靠谱队友的重要性

## 开发流程简介

我们将一款产品开发-试产-上市-更新-淘汰的进度分成100份，即从0到100，于是可以分成两个板块：从0到1和从1到100。从0到1的过程需要合理的商业计划和产品研发人员的努力攻关，而从1到100的过程则需要销售、运营、维护人员的持续投入。这里我们主要谈的还是从0到1这个过程

### 商业论证分析



### 市场需求调研

软件设计第一准则：**少即是多、极简主义、做产品要克制**

但这并不适用于硬件。我们往往会发现很多硬件设备总要提供用户可能觉得有用但永远也用不上的特性，或者说“我可以不用，但你不能没有”。探寻其中原因，很重要的一点是用户获取软件产品的成本接近为0，因此软件的核心是满足用户核心功能、让用户减少思考、快速喜欢你的设计和体验，以便留住用户，在后续养成习惯后再通过种种方式盈利；如果用户看不懂、学不会、感觉无趣，就很可能抛弃产品转向竞品，盈利也就无从谈起。而用户购买硬件是硬件产品的主要盈利方式，大部分用户也更从性价比方向考虑，功能多少和是否满足需求没有直接关系，用户总喜欢更多选择、功能更全的产品，品牌与价钱、外观和设计也在用户购买对比的重要范畴内；至于学习成本和乐趣则是在购买产品之后的事了，这应当属于嵌入式可靠性的关注领域，在开发过程中无需过多考量。

总的来说，硬件产品的第一准则是：**让用户产生购买欲望和行为**；第二准则是：**提高用户使用体验，形成口碑效应**；第三准则：**提供优秀的维护和维修服务**

> 硬件的产品不能简单推崇极简主义——有足够多、够炫酷的功能作为卖点，在与竞品同档位竞争时，能够脱颖而出往往才是关键

现在不少互联网公司简单照搬互联网思维做智能硬件，推出的产品外观优美、维护完善，但竞争力往往不足，很多情况下就是忽略了用户心理所重视的性价比。

产品的细节体验是全流程的：从产品设计理念、功能细节设计、说明书设计、产品发布方案、拿货流程、拆包体验，到用户开始用的过程、客服体系、售后维护、入户/营业点/返厂维修流程，都是产品设计的挑战；而不简简单单地考虑智能硬件的软件部分：如何让用户学习成本低、如何让设备真正体现出智能化、让用户行为等更多沉淀等等

硬件产品与软件的一大不同在于可能每增加一点小功能都会导致工序增加甚至要在产线上新增一个流程；同样创新的功能依赖于硬件和软件的协同实现，软件产品中技术和性能很少成为瓶颈，但硬件产品的创新是可能会导致用户体验下降的

### 立项和调研

在开始立项后，需要由软件、硬件负责人，EE架构师，供应链负责人，生产、测试等各部门负责人进行立项会议统筹决定产品需求的合理性，并通过项目经理和市场负责人的调研来进一步确定产品形态、结构、芯片方案、生产测试方案、供应链等事项

### 产品研发实现

和做软件敏捷开发、小步快跑的思路不同，硬件产品牵一发而动全身。在研发过程中绝对不能轻易使用“快速迭代”的思路，**更改需求往往意味着整套系统的大改**。需求应当具有较强的完整性、确定性、可实现性以及必要的前瞻性，尤其是在产品定位、功能范围、时间周期三个关键点上。产品定位和功能往往紧密联系，功能多少可能影响用户选择，功能难易可能影响后续开发进度、功能形式可能影响用户范围，这三者又共同决定了产品定位。而时间周期的设计中还需要考虑实现难度、生产时间、物流速度、上市节点时产品竞争力等等

硬件公司经常遇到的一个情况是：前一年自己的技术在领域内鹤立鸡群，但在下一代产品研发过程中，新公司开始冒头，新产品追赶上了自己的产品，而到新产品发布后，新公司的同期发售的产品已经达到了竞品的水准，仿照自己老产品的竞争对手也出现了一大批

面对这样的情况，产品设计者就要在产品的前瞻性上下功夫，不能设计无法完成的需求，也不能设计可能落伍的需求

### 系统测试和试产

最初的硬件样品需要在基本功能实现后进行系统测试，主要验证功能，但也要涵盖EMC、安规、工况、机械应力、防水/防雾等关键指标测试，有些产品还需要到第三方机构进行各种认证测试（比如CE、TUV、UL等）

完成测试后，生产负责人就需要拉上各相关研发开会讨论具体的生产方案和产品测试方案、老化测试方案等等。为了满足生产过程中的批量化测试需求，往往还会引入相关自动化测试部门的工作人员，最终得到一套可实行的量产方案，进行小批量试产。如果试产验收完成合格，就可以开始批量生产了。

### 量产化

开始量产的产品会被交付到市场销售（Marketing）、技术支持（FAE）等部门进行维护支持，在这时，产品才算真正上市。
