# 嵌入式可靠性基础5【用户】

还记得嵌入式可靠性的标准吗？**可靠性设计的标准是用户满意**

> 没有人的技术毫无意义

工程师在进行嵌入式开发时应当从三个主要方面满足用户要求。首先就是**嵌入式安全性**：产品绝对不能对用户的安全造成威胁，一旦出现问题，公司就上新闻喽，这一点是所有产品的底线。其次是**可用性**：产品的操作便捷性、外观时尚新颖等“软实力”往往决定着销量和口碑，好的产品优点不一，但坏的产品一定都卖不出去——工程师也要向市场负责。最后是**可维修性**：嵌入式可靠性的目标就是保障系统在规定时间、规定条件下，完成规定功能，但如果在产品出现问题时完全无法维修或者维修费用高昂，用户也会觉得自己的利益受到损害，这隐隐降低了产品的销量。

## 嵌入式安全性

在设备工作中保障人员安全是第一要务

安全性包括三部分：嵌入式系统对**人**的安全性影响、对周边关联**设备和环境**的安全性影响、对整机**设备自身**的安全性影响。当系统出现单一故障（Single Fault Condition，SFC）时，系统的输出功能必须保证是安全的，不允许产生对这三方面有影响的任何安全隐患

如果系统存在不安全隐患，就需要有对不安全因素的防护措施，这一点既有独立于各行业的通用**基础性安规**标准，也存在对本专业适用性很强的安规标准和设计规范（所谓的“**专标**”）

电气行业的专标会在下一章进行详细叙述，本篇主要讲述通用安规的基本定义和内容

### 基本定义

* **I类设备**：使用电网电源供电且有保护接地端子的设备，如空调、台式计算机等

    I类设备对电击的防护不仅依靠基本绝缘，还要附加安全保护措施和保护接地

* **II类设备**：使用电网电源或低压直流供电且没有保护接地端子，如家用电视机，220V供电，插头是火线和零线，没有地线（浮地）

    II类设备对电击的防护要依靠加强绝缘，但没有保护接地

* **应用部分**：设备中用来与操作者、作用对象相接触的全部部件

    根据应用部分不同，设备可以分成B型、BF型、CF型、F型

    * B型：对电击有特定防护程度的设备
    * F型：同设备其他各部分相隔离的应用部分相比绝缘强度应达到在应用部分和地之间加1.1倍最高额定电网电压时，与人体接触的漏电流在单一故障状态时不超过安规标准
    * BF型：有F型应用部分的B型设备
    * CF型：与人体有直接电接触的应用部分（例如心电设备、电针灸设备等）

* **漏电流**：非功能性电流，包括外壳漏电流、对地漏电流

* **电气间隙**：两个导体部件之间的最短空气距离

* **爬电距离**：沿两个导体部件之间的绝缘材料表面的最短路径

### 标记

设备上给予清晰的标记可以帮助用户快速识别潜在危险源，通常要满足以下要求。

外部标记包括生产供应单位、型式标记、与电源连接、电源频率、输入功率、熔断器、输出等。内部标记包含供给生产装配、维修人员使用，包括最大负载功率、功能接地端、电池装入方法等。控制器件与仪表标记要求必须有电源开关的识别和表示，控制器件和开关的挡位表示和标记（比如清楚的识别通断位置）。导线绝缘层在各行各业的安规中都有统一的颜色标准，也应当遵守。指示灯的红、黄、绿三种颜色分别标识危险、注意和正常

### 环境条件

环境条件的首要因素是设备的供电方式和安全类型，根据I类设备、II类设备和内部电源设备不同，设备的运输存储环境、运行环境和供电环境也有不同

运输环境：如相对温度、大气压力、环境温度

运行环境：如相对温度、大气压力、环境温度

供电环境：如电压波动、频率误差、内部电源如可更换则由制造厂商提供

以上环境条件都应该根据产品类型、工况和国家标准要求加以注明

### 电击防护

剩余电压标准：例如用插头和电源连接的嵌入式系统，在拔断插头后1S，插件和机身之间电压不超过60V

剩余能量标准：设备电源切断后，立即打开机壳，剩余电压不超过60V，若超过，剩余能量不超过2mJ

外壳的封闭性标准：设备壳体必须能保护住在单一故障状态下可能带电的部分，不用工具就可以打开的罩、门和可能带电的部件都要隔离。还应当保证在机械危险发生后，嵌入式系统电气部分不得产生危险。如设备跌落撞出凹痕，引起电介质强度变化，但不能导致危险

灯泡的安全性：在其更换时避免与带电部件接触

控制器件的导体部分电阻不大于0.2欧姆或绝缘隔离

带电部件须有防护罩和标记

应用部分不得与未保护接地的可触或金属部件有导电连接

电气连接部分应当：满足电气间隙和爬电距离要求；连接点防止意外脱开；对能形成点燃源的设备，不得配置可拆卸的电源软电线

必须采用适当的组合进行静电防御

运行在交流2000V、直流2400V以上的设备，且未装在封闭壳内部，必须设计成不会发生电晕

> 电晕是指由于高电压使周围空气产生电离,当电压梯度超过一定临界值时,在导体表面和它的附近出现紫蓝色辉光的放电现象

当供电电源中断后又恢复时，除预定功能中断外，不会产生安全方面的危险；当电源中断时，必须有消除作用对象上的机械压力的措施

## 嵌入式可用性

嵌入式系统的可用性是产品可靠性的关键一环，嵌入式系统需要软件、硬件、机械、人工操作四方面协作完成功能，在其中凡是需要人工参与的地方，均有可能因为人的错误而导致系统出错。可用性设计的主要内容就是围绕人可能犯错的地方，借助完善的软硬件设计来规避问题，主要包含*视觉*、*控制*、*报警*、*照明*等内容

### 视觉显示要求

对于用户来说，用户界面（UI）即系统，因此界面设计承载了客户对产品所能认知的全部内容。即使内部设计精良，但细节上的确实仍会给用户留下粗糙、低档、不专业的印象。好的UI设计往往能为产品添彩，从侧面促进产品销售

当然UI首先应当满足规范性的技术要求，UI界面的艺术设计是第二位的。正因如此，系统外观和界面设计要与工况、环境、特殊要求相匹配

> 纯黑色的金属风格的儿童游戏机和花花绿绿带卡通图案的商务投影仪一般来说都是不符合使用场景的

在操作界面的设计上，一般要求

* 采用一种主色调色彩，另有多种点缀色，但不应当采用两种对比明显的主色调
* 操作菜单尽量不超过3层，常用功能的选择不超过三个菜单选择或按键操作就能完成
* 同一个界面下不应该有重复的数据信息或经过换算能得到同一物理量的结果，避免使用户困惑；物理量的显示方式也应该更直接，不需要用户额外换算处理
* 符号和图形信息应当分区，符合用户日常操作其他家用电器和数码产品的习惯
* 界面上弹出信息的变化不应太快或太慢，一般以每秒2字速度为宜
* 显示界面边界流出余量，表面文字对比度拉高
* 要考虑人的视角范围，让用户不必俯仰头部、转动眼球就能浏览到界面所有信息。一般人头部自由状态为在水平线下方10度，在头部自由状态下，向上15度、向下45度为人眼能够达到的视场。显示界面应当与人眼平视斜向下15到45度范围内垂直
* 要考虑人眼睛分辨率，让用户不觉得画面模糊。人眼具有一个最小分辨角1.5'（0.025°），当屏幕像素间距小于R*1.5'时，会让图像看起来细腻连续，否则图像会显得粗糙
* 监视信息和主要参数应当在同一界面显示，在大小、色彩上有明显区分，布局应当分开；需要长期观察的信息应当采用柔和色彩防止用户视觉疲劳，同时非预期变化值的显示应当强烈而突出
* 在室外阳光下工作的设备应配备高亮显示器或采用无背光墨水屏，让用户能清晰看到UI
* 界面字符大小应当保证在振动下也能让用户看清

### 操作控制布局要求

控制按键的布局对应用户操作设备的方式，最基本的设计准则就是：**符合用户最普通的操作习惯**

控制器设计至少应当满足四个要求：

* 操作/控制分区合理，不应堆砌在一起
* 按钮操作有效果反馈指示
* 使用设备时控制器位置符合人体工学
* 被控量和操作方式应当符合直觉上的逻辑关系

此外，旋钮和按键的调节力度需要把控，如果能够加入力反馈机制是最理想的。一般人旋转手柄的调节力道从手腕、手肘到胳膊依次增大，最大不能超过8kg。面板按键行程和用力大小直接影响操作者手感，因此按键生效的力度范围应当在200g-1000g之间

最重要的控制动作应当适应左右手的操作习惯，以防止紧急状态下左惯手用户误操作。开关、按钮、旋钮周边空间不应受周围部件、结构影响，要放置在易于发现或有明显位置提示处。需要紧急停机、中断的控制动作所需时间不应超过1s

### 听觉与报警设计

报警是嵌入式系统可靠性设计的重要组成部分。系统出现故障时，应当能即使切断危险输出并报警，因此报警及时性、信息准确辨别、报警应对处理的帮助信息是可靠性设计的关键部分

声音报警是最主要的报警方式，要求：

* 报警信息应当具有较高的实时性，如果最大报警条件延时与最大报警信号延时之和大于10s，或平均最大报警条件延时与平均最大报警信号产生延时之和大于5s，那么应当额外在操作说明中注释
* 操作者察觉后可以关闭声音报警，但视觉显示还存在直到故障解除
* 声音报警不应被外界嘈杂环境掩盖
* 声音报警不应对外界其他工作区造成过大影响
* 声音报警应当针对人耳最敏感的500~3000Hz频率设计

如果声音报警能够结合光学报警，可以让可靠性有一个提高。一些不太紧急的消息无需使用声音报警。视觉报警信号是声音报警信号的补充，但任何报警条件都应当至少产生一个视觉报警信号，最高优先级设置为红色；中级设置为黄色；低级设置为蓝绿色或黄色；避免使用绿色作为报警信号，因为绿色在通常意义中表示安全，容易引起用户误判

当电源掉电时间小于或等于30s时，报警设置应优先于电源自动复位，防止误报

## 嵌入式可维修性

对产品来说，设计的首要任务是应用的安全，其次是利润。利润的产生有两个途径：开源和节流。开源是指让产品具有更多的附加值、提高产品销量；节流的核心则是可维修性

> 硬件产品和软件开发存在着非常大的差异，详细内容可以参考笔者的《硬件开发进度管理》笔记。对于智能硬件，其瀑布流开发方式决定了产品在立项阶段就需要有前瞻性，而硬件产品往往更对生命周期后期缺乏重视——我们主要关注对用户造成影响的嵌入式可靠性环节，因此这一环节是我们要探讨的

维修产生的成本支出（尤其是产品保修期内的支出）会导致产品净利润下降，因此提高产品可维修性也能够间接提高产品利润

### 可维修性分级

根据维修地点不同，民用产品可以分为

* **用户级**：用户现场即可维修
* **中间商级**：在办事处、经销商或代理商处维修
* **厂部级**：返厂维修

上述三个等级的时间和金钱成本依次增高，

### 维修性的定性要求

设计时应当对产品功能进行分析，合并相同或相似功能，消除不必要功能以简化产品操作和维修步骤。在满足功能要求的条件下，越简单、层次越少、耦合越低的产品，可维修性越好，这和软件工程中的可维护性是一个道理。同时，产品的机械结构设计应当剔除不必要的部分，排除因磨损或漂移等原因引起的常见故障；对易磨损和贵重件，可以设计成可拆卸或可调整的组合件，以便于局部更换或修复。最后，要合理安排各组成部分的位置，减少连接件和固定件，这样能够方便检测和更换部件，降低维修人员技术水平要求和工作量

根据上述内容，可以总结出可维修性的要求包括

* 可达性

    需要维修和拆装的零部件周围应当保留足够的操作空间，易损件、常拆件和附加设备的拆装要简便。维修时能看见内部操作为佳

* 标准化互换性

    设计时优选标准化的设备，保证故障率高、易损坏、关键性零部件要具有良好的互换性和通用性，接口应当完全兼容且便于测试调整

* 防差错措施

    设计时应当考虑到在使用和维修时造成人为差错的可能，加入防呆设计，并且尽量保证即使出现差错也不应危及人机安全。应在产品规定位置设置明显的警示标志，对测试点和连接电标明名称和必要的数据

* 可测试性

    应当在设计时就确定好在出厂检测和维修中可以使用测试点和治具，测试点和测试基准不应设置在易损坏的部位，优选原位检测方式，重要部位采用性能检测和故障报警装置。在复杂系统中，还应当采用机内测试、外部自动测试、测试软件、人工测试等形成综合诊断体系，保证能迅速、准确判明故障部位

* 人机环工程要求

    根据使用和维修时人员的位置、姿势和使用工具情况在设计时预留适当的操作空间，应当考虑维修人员的工作负荷和难度适当

* 预防性维修设计

    应当避免让设备需要依赖预防性维修（即需要拆机更换关键器件维护设备正常工作），如果难以实现，也应当减少维修内容和频率

* 维修安全

    设计时应当保障系统在故障或分解状态进行维修是安全的，并在可能发生危险的部位上标记醒目警告。严重危及安全的组成部分应当有自动防护措施，不要将被损坏后容易发生严重后果的组成部分设置在易被损坏的位置。设计中应当做到防静电、防电击、防辐射、防火，保障人员安全。其中防点击部分要求高压电路与电容器断电后2s内电压能够降低到36V以下，或提供安全放电装置

* 合理的维修作业程序

    维修程序的目的就是降低维修人员需要的技能水平和维修时间。合理的维修程序能够保障维修人员尽可能少地犯错，并提高维修速度、减少开支。但维修程序不应当过于繁琐，尽量避免维修人员查阅设计手册或进行不可靠的决断。在诊断时应当尽量采用机内测试（BIT），如需采用外部测试设备，也应采用测试结果为“通过/不通过”

### 可维修性定量评估指标

定量分析可维修性的指标有以下几种

* **平均修复时间**（MTTR）

    排除故障所需实际修复时间的平均值。MTTR的观测值等于一给定时间内，修复时间的总和与修复次数之比。针对不同的维修级别，同一产品也会有不同的平均修复时间，因此在提出此指标时应当同时指明维修级别。

* **最大修复时间**

    设备达到规定维修度（全部维修工作的某个百分数）所需的修复时间

* **平均维修时间**

    设备每次维修所需实际时间的平均值

* **维修性指数**

    每工作小时的平均维修工时，用公式
    $$
    MI = \frac{MMH}{OH}
    $$
    式中MMH是设备在规定使用期间内的维修工时；OH是设备规定的工作小时数

此外，**维修费用指标**（设备规定使用时间内的平均维修费用与平均工作年数之比）也常用于反映产品的维修代价

